using System;
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;
using System.ComponentModel;
using System.Diagnostics;
using System.ServiceProcess;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace StartForm {
    public class Joke {
        private readonly Random rand = new();
        private const int numberof = 1;

        //[DllImport("User32")]
        //private static extern int ShowWindow(int hwnd, int nCmdShow);

        public Joke()
        {
            //Process.GetProcesses();
            //Process.GetProcesses().FirstOrDefault(p => p.ProcessName.Contains(NAME)
            //Process.GetProcessesByName(NAME)

            //var proc = new Process();
            //proc.StartInfo
            //proc.InitializeLifetimeService
            //proc.Start();

            //ServiceBase sb = new();
            //ServiceController sc = new();
        }

        public void Run()
        {
            //todo: timer controlling events
            //while ( true ) {
            for ( int i = 0; i < 10; i++ ) {
                Popup();//tmp
                switch ( rand.Next(numberof) ) {
                    case 0:
                        break;
                    case 1:
                        break;
                    default:
                        //MessageBox.Show("test");
                        break;
                }
            }
        }

        private void RotateScreen()
        {
            switch ( rand.Next(4) ) {
                case 0:
                    SendKeys.Send("^%{UP}");
                    break;
                case 1:
                    SendKeys.Send("^%{DOWN}");
                    break;
                case 2:
                    SendKeys.Send("^%{LEFT}");
                    break;
                case 3:
                    SendKeys.Send("^%{RIGHT}");
                    break;
            }
        }

        private void EditClipboard()
        {
            string text;
            //todo: set text to random funny
            text = "test";
            Clipboard.SetText(text);
        }

        private void KeyLock()//sendkey sends to app not windows
        {
            switch ( rand.Next(3) ) {
                case 0:
                    SendKeys.Send("{SCROLLLOCK}");
                    break;
                case 1:
                    SendKeys.Send("{NUMLOCK}");
                    break;
                case 2:
                    SendKeys.Send("{CAPSLOCK}");
                    break;
            }
        }

        private async void ShowCommand()
        {
            using var proc = new Process();
            proc.StartInfo.FileName = "cmd.exe";
            proc.StartInfo.RedirectStandardInput = true;
            proc.Start();
            using ( var stdin = proc.StandardInput ) {
                stdin.AutoFlush = true;

                stdin.WriteLine("dir");//todo: random command

                await Task.Delay(1500);
                stdin.WriteLine("exit");
            }
            proc.WaitForExit();
        }

        private void Popup()
        {
            string text = rand.Next(17) switch {
                0 => "Deleting System32",
                1 => "Windows has finished removing System32",
                2 => "Fatal error while opening FILE NAME HERE",
                3 => "System32 is corrupted or missing",
                4 => "Searching for backup file for System32",
                5 => "Allow task?",
                6 => "Unable to find backup files for System32",
                7 => "critical error",
                8 => "Reboot the computer?",
                9 => @"Failed to access data from C:\Windows\System32\",
                10 => "Fatal memory_data error, we advise to shut down Windows to prevent further damage",
                11 => "Contact Microsoft Windows support",
                12 => "Request has been sent to the support team",

                13 => "Error while opening computer",
                14 => "Unable to resolve error",
                15 => "Do you want to scan this computer?",
                16 => "Click me",
                _ => string.Empty
            };

            string caption = rand.Next(6) switch {
                0 => "Info",
                1 => "Error",
                2 => "critical error",
                3 => "Click me",
                >3 => ""
            };

            MessageBox.Show(text, caption);
        }
    }
}
